# -*- coding: utf-8 -*-
"""align_ccs.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1fQr0bRrK908Ijw0ie3skDgAS5BrhTFFW
"""

import numpy as np
import pandas as pd

def findshift(data,test):
  data["Sequence"] = data["Sequence"] + data["Charge"].astype(str)
  data = data.set_index('Sequence').T.to_dict('series')
  test["Sequence"] = test["Sequence"] + test["Charge"].astype(str)
  test = test.set_index('Sequence').T.to_dict('series')

  common = []
  row = []
  for key, value in data.items(): 
    if key in test:
      value2 = test.get(key)
      row = [key, value["CCS"], value2["CCS"]]
      common.append(row)
    row = []
    
  df = pd.DataFrame(common, columns = ['Seq', 'CCS1','CCS2']) 
  CCS1 = np.array(df["CCS1"])
  CCS2 = np.array(df["CCS2"])
  deltaCCS = (CCS1-CCS2)

  mean = np.mean(deltaCCS)
  standard_deviation = np.std(deltaCCS)
  distance_from_mean = abs(deltaCCS - mean)
  max_deviations = 2
  not_outlier = distance_from_mean < max_deviations * standard_deviation
  no_outliers = deltaCCS[not_outlier]
  processed_mean = np.mean(no_outliers)
  print("Shift = " + processed_mean)
  print("Number of common peptides" + len(common))
  
  return processed_mean